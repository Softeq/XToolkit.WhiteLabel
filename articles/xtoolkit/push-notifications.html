<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>XToolkit Push Notifications | XToolkit.WhiteLabel </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="XToolkit Push Notifications | XToolkit.WhiteLabel ">
    <meta name="generator" content="docfx ">
  
    <link rel="shortcut icon" href="../../images/logo.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc">
    <meta property="docfx:tocrel" content="../toc">
  
  <meta property="docfx:rel" content="../../">
  <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>

        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>

              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../images/logo.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>

                <ul class="nav level1 navbar-nav">
                      <li>
                          <a href="../../articles/getting-started.html" title="Articles">Articles</a>
                      </li>
                      <li>
                          <a>API Documentation</a>
                      </li>
                      <li>
                          <a href="https://github.com/Softeq/XToolkit.WhiteLabel" title="GitHub">GitHub</a>
                      </li>
                </ul>            </div>
          </div>
        </nav>

        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">

        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div>
              <div class="sidefilter">
                <form class="toc-filter">
                  <span class="glyphicon glyphicon-filter filter-icon"></span>
                  <input type="text" id="toc_filter_input" placeholder="Enter here to filter..." onkeypress="if(event.keyCode==13) {return false;}">
                </form>
              </div>
              <div class="sidetoc">
                <div class="toc" id="toc">

                  <ul class="nav level1">
                    <li class="">
                      <a href="../manifesto.html" title="Manifesto" class="">Manifesto</a>
                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../getting-started.html" title="Getting Started" class="">Getting Started</a>

                        <ul class="nav level2">
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../configure-ios.html" title="Configure iOS" class="">Configure iOS</a>

                              <ul class="nav level3">
                                <li class="">
                                  <a href="../create-storyboard-viewcontroller.html" title="Create Storyboard/ViewController" class="">Create Storyboard/ViewController</a>
                                </li>
                              </ul>                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../configure-android.html" title="Configure Android" class="">Configure Android</a>

                              <ul class="nav level3">
                                <li class="">
                                  <a href="../create-activity.html" title="Create Activity" class="">Create Activity</a>
                                </li>
                              </ul>                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../create-viewmodel.html" title="Configure Core" class="">Configure Core</a>

                              <ul class="nav level3">
                                <li class="">
                                  <a href="../create-viewmodel.html" title="Create ViewModel" class="">Create ViewModel</a>
                                </li>
                              </ul>                          </li>
                        </ul>                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../xtoolkit/overview.html" title="XToolkit" class="">XToolkit</a>

                        <ul class="nav level2">
                          <li class="">
                            <a href="../xtoolkit/overview.html" title="Overview" class="">Overview</a>
                          </li>
                          <li class="">
                            <a href="../xtoolkit/common.html" title="Common" class="">Common</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../xtoolkit/bindings.html" title="Bindings" class="">Bindings</a>

                              <ul class="nav level3">
                                <li class="">
                                  <a href="../xtoolkit/bindings/bindable.html" title="Bindable" class="">Bindable</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/bindings/advanced.html" title="Advanced Bindings" class="">Advanced Bindings</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/bindings/collections.html" title="Collections" class="">Collections</a>
                                </li>
                              </ul>                          </li>
                          <li class="">
                            <a href="../xtoolkit/connectivity.html" title="Connectivity" class="">Connectivity</a>
                          </li>
                          <li class="">
                            <a href="../xtoolkit/permissions.html" title="Permissions" class="">Permissions</a>
                          </li>
                          <li class="active">
                            <a href="../xtoolkit/push-notifications.html" title="Push Notifications" class="active">Push Notifications</a>
                          </li>
                          <li class="">
                            <a href="../xtoolkit/remote.html" title="Remote" class="">Remote</a>
                          </li>
                          <li class="">
                            <span class="expand-stub"></span>
                            <a href="../xtoolkit/whitelabel.html" title="WhiteLabel" class="">WhiteLabel</a>

                              <ul class="nav level3">
                                <li class="">
                                  <a href="../xtoolkit/whitelabel/ios.html" title="iOS" class="">iOS</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/whitelabel/droid.html" title="Droid" class="">Droid</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/whitelabel/bootstrapper.html" title="Bootstrapper" class="">Bootstrapper</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/whitelabel/di.html" title="Dependency Injection" class="">Dependency Injection</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/whitelabel/mvvm.html" title="MVVM" class="">MVVM</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/whitelabel/navigation.html" title="Navigation" class="">Navigation</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/whitelabel/navigation-requirements.html" title="Navigation Requirements" class="">Navigation Requirements</a>
                                </li>
                                <li class="">
                                  <a href="../xtoolkit/whitelabel/validation.html" title="Validation" class="">Validation</a>
                                </li>
                              </ul>                          </li>
                          <li class="">
                            <a href="../xtoolkit/whitelabel/essentials.html" title="WhiteLabel.Essentials" class="">WhiteLabel.Essentials</a>
                          </li>
                          <li class="">
                            <a href="../xtoolkit/whitelabel/forms.html" title="WhiteLabel.Forms" class="">WhiteLabel.Forms</a>
                          </li>
                          <li class="">
                            <a href="../xtoolkit/version-support.html" title="Version Support" class="">Version Support</a>
                          </li>
                        </ul>                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../how-to/index.html" title="How to" class="">How to</a>

                        <ul class="nav level2">
                          <li class="">
                            <a href="../how-to/create-ios-custom-view.html" title="Create iOS Custom View" class="">Create iOS Custom View</a>
                          </li>
                          <li class="">
                            <a href="../how-to/create-ios-collection-view.html" title="Create iOS CollectionView" class="">Create iOS CollectionView</a>
                          </li>
                        </ul>                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../practices/index.html" title="Practices" class="">Practices</a>

                        <ul class="nav level2">
                          <li class="">
                            <a href="../practices/android-res-naming.html" title="Android Resources Naming Convention" class="">Android Resources Naming Convention</a>
                          </li>
                          <li class="">
                            <a href="../practices/unit-tests.html" title="Unit Tests" class="">Unit Tests</a>
                          </li>
                        </ul>                    </li>
                    <li class="">
                      <span class="expand-stub"></span>
                      <a href="../contributing.html" title="Contributing" class="">Contributing</a>

                        <ul class="nav level2">
                          <li class="">
                            <a href="../contributing-workflow.html" title="Contribution Workflow" class="">Contribution Workflow</a>
                          </li>
                          <li class="">
                            <a href="../contributing-documentation.html" title="Documentation" class="">Documentation</a>
                          </li>
                          <li class="">
                            <a href="../developer-guide.html" title="Developer Guide" class="">Developer Guide</a>
                          </li>
                          <li class="">
                            <a href="../nuget-release-process.html" title="NuGet Release Process" class="">NuGet Release Process</a>
                          </li>
                        </ul>                    </li>
                  </ul>                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="xtoolkit-push-notifications">XToolkit Push Notifications</h1>

<p>Rich implementation of common cases for push-notifications using APNs and Firebase Cloud Messaging.</p>
<h2 id="install">Install</h2>
<p>When you use this component separately from WhiteLabel.</p>
<p>You can install via NuGet: <a href="https://www.nuget.org/packages/Softeq.XToolkit.PushNotifications"><img src="https://buildstats.info/nuget/Softeq.XToolkit.PushNotifications?includePreReleases=true" alt="Softeq.XToolkit.PushNotifications"></a></p>
<pre><code class="lang-text">Install-Package Softeq.XToolkit.PushNotifications
</code></pre>
<h2 id="setup">Setup</h2>
<h3 id="core">Core</h3>
<ol>
<li>Add the following WhiteLabel projects to references:</li>
</ol>
<ul>
<li><code>Softeq.XToolkit.PushNotifications</code></li>
</ul>
<ol start="2">
<li>Add implementation for <code>IPushNotificationsHandler</code>, do whatever you want in:</li>
</ol>
<ul>
<li><code>HandlePushNotificationReceived</code></li>
<li><code>HandlePushNotificationTapped</code></li>
<li><code>HandleSilentPushNotification</code></li>
</ul>
<blockquote>
<p>all of these methods receive <code>PushNotificationModel</code>.</p>
</blockquote>
<ul>
<li><code>OnPushRegistrationCompleted</code> has parameters showing if registration was completed in system and on server, you can handle it additionally if needed</li>
<li><code>HandleInvalidPushNotification</code> allows you to handle errors during notification parsing, it contains an Exception and a raw notification object</li>
<li><code>OnPushPermissionsRequestCompleted </code> is relevant for iOS platform only and allows you to analyze user reaction to notifications permission request (registration will be performed in any case)</li>
</ul>
<ol start="3">
<li>Use default implementation(<code>PushTokenStorageService</code> which uses <code>IInternalSettings</code>) or add your own implementation for <code>IPushTokenStorageService</code> which:</li>
</ol>
<ul>
<li>implements <code>PushToken</code> getter and setter to store the token in internal settings, for instance</li>
<li>implements storing <code>IsTokenRegisteredInSystem</code> and <code>IsTokenSavedOnServer</code> flags</li>
</ul>
<ol start="4">
<li>Add implementation for <code>IRemotePushNotificationsService</code>:</li>
</ol>
<ul>
<li>implement methods to send push token to the server and remove it from server</li>
</ul>
<ol start="5">
<li><p>Register your implementations in <code>Bootstrapper</code> (IPushNotificationsHandler, IRemotePushNotificationsService), also register an implementation of <code>ILogManager</code></p>
</li>
<li><p>Register <code>PushTokenStorageService</code> or your implementation as <code>IPushTokenStorageService</code> in <code>Bootstrapper</code>; if you use default PushTokenStorageService then also register <code>IInternalSettings</code> implementation (possibly in platform projects)</p>
</li>
</ol>
<h4 id="optionally">Optionally</h4>
<ul>
<li>Add enum for push types and a method to convert string type to enum value</li>
</ul>
<h4 id="usage">Usage</h4>
<ul>
<li><p>When you want to subscribe to notifications call <code>IPushNotificationsService</code> method <code>RegisterForPushNotifications</code></p>
</li>
<li><p>When you want to unsubscribe from notifications call <code>IPushNotificationsService</code> method <code>UnregisterFromPushNotifications</code>, with true parameter if you want to unsubscribe in system as well (default parameter value is false)</p>
</li>
<li><p>When you want to clear notifications in notification center call <code>IPushNotificationsService</code> method <code>ClearAllNotifications</code></p>
</li>
<li><p>When you want to manually set a value for app badge call <code>SetBadgeNumber</code> with required value (NOTE: on Android <a href="https://github.com/wcoder/ShortcutBadger">https://github.com/wcoder/ShortcutBadger</a> is used and not all devices are supported)</p>
</li>
</ul>
<h3 id="ios">iOS</h3>
<ol>
<li>Add the following WhiteLabel projects to references:</li>
</ol>
<ul>
<li><code>Softeq.XToolkit.PushNotifications</code></li>
<li><code>Softeq.XToolkit.PushNotifications.iOS</code></li>
</ul>
<ol start="2">
<li><p>Perform standard setup: Add Provisioning profile with Push Notifications capability and pass APNs certificates to the server-side</p>
</li>
<li><p>Add implementation for <code>INotificationsPermissionsService</code>:</p>
</li>
</ol>
<ul>
<li>you can use default implementation <code>IosNotificationsPermissionsService</code></li>
<li>you can override <code>IosNotificationsPermissionsService</code> and provide custom authentication options as <code>RequiredAuthOptions</code></li>
<li>you can provide your own implementation of <code>INotificationsPermissionsService</code> with <code>RequestNotificationsPermissions</code> method using toolkit <code>PermissionManager</code> for instance</li>
</ul>
<ol start="4">
<li>If needed add custom subclass of <code>IosPushNotificationParser</code> where you can:</li>
</ol>
<ul>
<li>specify custom key for additional data part of the notification (stored as a peer for apps) - you will be able to handle it as you wish later, default key is <code>Data</code>;</li>
<li>specify custom way to obtain string type from notification, without it the type will always be an empty string, to do this you have the whole notification, the aps part and the additional data part</li>
</ul>
<ol start="5">
<li><p>If you want to register some categories for your notifications (with or without actions), add an implementation for <code>INotificationCategoriesProvider</code>. Default implementation <code>IosNotificationCategoriesProvider</code> does not contain any categories but provides helper methods for simplified actions and categories setup so you can override it to set up your categories.</p>
</li>
<li><p>Register your implementations in <code>Bootstrapper</code> (INotificationsPermissionsService, IosPushNotificationParser or your custom subclass as IPushNotificationParser, IosNotificationCategoriesProvider if you do not need to work with categories or your custom subclass if you do need to specify some categories as INotificationCategoriesProvider)</p>
</li>
<li><p>Register <code>IosPushNotificationsService</code> as <code>IPushNotificationsService</code> in <code>Bootstrapper</code></p>
</li>
<li><p>In your <code>AppDelegate</code></p>
</li>
</ol>
<ul>
<li>In <code>FinishedLaunching</code> method call <code>IPushNotificationsService</code> method <code>Initialize</code> with <code>ForegroundNotificationOptions.ShowWithBadge</code> value if you want to display foreground notifications in system notification center and update badge value from notification as well, <code>ForegroundNotificationOptions.Show</code> value if you want to display foreground notifications in system notification center but not to update badge value from notification, <code>ForegroundNotificationOptions.DoNotShow</code> if you do not want to display foreground notifications in system notification center</li>
<li>Override <code>RegisteredForRemoteNotifications</code> method and call <code>IPushNotificationsService</code> method <code>OnRegisteredForPushNotifications</code> with <code>deviceToken.AsString()</code></li>
<li>Override <code>FailedToRegisterForRemoteNotifications</code> method and call <code>IPushNotificationsService</code> method <code>OnFailedToRegisterForPushNotifications</code> with <code>error.Description</code></li>
<li>If you want to receive silent push notifications override <code>DidReceiveRemoteNotification(with completionHandler)</code> method and call <code>IPushNotificationsService</code> method <code>OnMessageReceived</code> with <code>userInfo</code> and any value as second parameter. Do not forget to invoke completionHandler. (Make sure that <code>aps</code> in notification payload contains <code>content-available:1</code> and does not contain <code>alert</code>, <code>sound</code> or <code>badge</code> keys)</li>
</ul>
<ol start="8">
<li>Additionally if needed (for silent push notifications) you can add to your <code>Info.plist</code> UIBackgroundModes <code>remote-notification</code></li>
</ol>
<h3 id="android">Android</h3>
<ol>
<li>Add the following WhiteLabel projects to references:</li>
</ol>
<ul>
<li><code>Softeq.XToolkit.PushNotifications</code></li>
<li><code>Softeq.XToolkit.PushNotifications.Droid</code></li>
</ul>
<ol start="2">
<li>Perform standard Firebase setup</li>
</ol>
<ul>
<li>Create application project in Firebase Console and pass Server Key to the server-side</li>
<li>Add <code>Xamarin.Firebase.Messaging</code> to packages</li>
<li>Add <code>google-services.json</code> to root Droid project with Build Action &gt; <code>GoogleServicesJson</code></li>
<li>Add the following to your <strong>AndroidManifet.xml</strong> inside <code>&lt;application&gt;</code>:</li>
</ul>
<pre><code class="lang-xml">&lt;receiver android:name=&quot;com.google.firebase.iid.FirebaseInstanceIdInternalReceiver&quot; android:exported=&quot;false&quot; /&gt;
&lt;receiver android:name=&quot;com.google.firebase.iid.FirebaseInstanceIdReceiver&quot; android:exported=&quot;true&quot; android:permission=&quot;com.google.android.c2dm.permission.SEND&quot;&gt;
    &lt;intent-filter&gt;
        &lt;action android:name=&quot;com.google.android.c2dm.intent.RECEIVE&quot; /&gt;
        &lt;action android:name=&quot;com.google.android.c2dm.intent.REGISTRATION&quot; /&gt;
        &lt;category android:name=&quot;${applicationId}&quot; /&gt;
    &lt;/intent-filter&gt;
&lt;/receiver&gt;
</code></pre>
<ul>
<li>Optionally add also the following to specify icon and color:</li>
</ul>
<pre><code class="lang-xml">&lt;meta-data android:name=&quot;com.google.firebase.messaging.default_notification_icon&quot; android:resource=&quot;@drawable/ic_notification&quot; /&gt;
&lt;meta-data android:name=&quot;com.google.firebase.messaging.default_notification_color&quot; android:resource=&quot;@color/notification_color&quot; /&gt;
</code></pre>
<ol start="3">
<li><p>Add <code>Mono.Android.Export</code> to references (required to be able to identify if notifications are received in foreground)</p>
</li>
<li><p>Add implementation for <code>INotificationsSettingsProvider</code> (they will be applied for manually shown notifications - all data 'notifications' and foreground 'notification' notifications):</p>
</li>
</ol>
<ul>
<li>Provide a dictionary of Notification Channels ids and names for Android 8+, the importance for each channel id, the default channel id and a method that returns channel id for specific notification</li>
<li>If needed provide additional configuration for each notification channel before it's registered (for instance, create and set a group) in <code>ConfigureNotificationChannel </code></li>
<li>Provide styles for manually shown notifications (return PushNotificationStyles object, where you have to specify NotificationCompat.Style and may customize other properties like an icon, etc.)</li>
<li>If needed add more customization of notification (like adding actions) in <code>CustomizeNotificationBuilder </code></li>
<li>Provide the type of the Activity which will be opened after tapping on the notification that was shown manually and if parent stack needs to be created for it</li>
<li>Additionally you can use helper methods from <code>NotificationActionsHelper</code> to work with actions and from <code>NotificationChannelsHelper</code> if you need to manage channel groups or notification channels that reflect user choices</li>
</ul>
<ol start="5">
<li>If needed add custom subclass of <code>DroidPushNotificationParser</code> where you can:</li>
</ol>
<ul>
<li>specify custom key for additional data part of the notification (stored inside RemoteMessage.Data) - you will be able to handle it as you wish later, default key is Data;</li>
<li>specify custom keys for title and body if you have them inside RemoteMessage.Data instead of RemoteMessage's Notification part</li>
<li>specify custom way to obtain string type from notification, without it the type will always be an empty string, you will have to override two methods - one gives you IDictionary which is RemoteMessage.Data, the other gives you Bundle which stores everything that was in RemoteMessage.Data</li>
</ul>
<ol start="6">
<li><p>Register your implementations in <code>Bootstrapper</code> (INotificationsSettingsProvider, DroidPushNotificationParser or your custom subclass as IPushNotificationParser)</p>
</li>
<li><p>Register <code>DroidPushNotificationsService</code> as <code>IPushNotificationsService</code> in Bootstrapper</p>
</li>
<li><p>In your <strong>MainApplication</strong> in <code>OnCreate</code> method call <em>IPushNotificationsService</em> method <em>Initialize</em> with <code>ForegroundNotificationOptions.Show</code> value if you want to display foreground notifications in system notification center, <code>ForegroundNotificationOptions.DoNotShow</code> otherwise</p>
</li>
<li><p>In your starting <strong>activity</strong> <code>OnCreate</code> check if <em>Intent?.Extras</em> are not null and contain push notifications data (you can check your custom data key for instance) and call <em>IPushNotificationsService</em> method <code>OnMessageTapped(extras)</code> in this case (might require a delay or passing forward and calling OnMessageTapped later)</p>
</li>
</ol>
<hr>
</article>
          </div>

          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/Softeq/XToolkit.WhiteLabel/blob/master/documentation/articles/xtoolkit/push-notifications.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
      <span>Copyright © <a href="https://www.softeq.com/">Softeq Development Corp.</a><span class="footer-docfx">Generated by <strong>DocFX</strong></span></span>
      
          </div>
        </div>
      </footer>
    </div>

    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
